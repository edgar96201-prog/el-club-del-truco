<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>El Club del Truco ‚Äì 1vs1 Definitivo</title>
<style>
body { margin:0; font-family: Georgia, serif; background:#0b3d2e; color:#fff; text-align:center;}
h1 { margin:15px 0; }
.menu, .mesa { max-width: 900px; margin:20px auto; }
.menu input, .menu select { margin:5px; padding:8px; font-size:16px; }
.menu button { margin:10px; padding:12px 25px; font-size:16px; border-radius:8px; cursor:pointer; }
.mesa { display:none; background:#145a32; border:6px solid #4a2c16; border-radius:20px; padding:15px; }
.cartas { display:flex; justify-content:center; gap:12px; min-height:130px; flex-wrap:wrap; }
.carta { width:80px; height:120px; border-radius:8px; display:flex; align-items:center; justify-content:center; cursor:pointer; overflow:hidden; background:#fdf6e3; transition: transform 0.2s;}
.carta:hover { transform: scale(1.05); }
.carta img { width:100%; height:100%; object-fit:cover; }
.rival .carta { cursor: default; }
.botones button { margin:5px; padding:8px 12px; font-size:14px; border-radius:8px; cursor:pointer; }
.log { background:#0e6655; padding:10px; border-radius:10px; min-height:80px; margin-top:10px;}
#temporizador { font-size:16px; font-weight:bold; margin-top:5px; }
#tantoJugador, #tantoRival { font-weight:bold; margin-top:5px; }
</style>
</head>
<body>

<h1>üÉè El Club del Truco</h1>

<div class="menu" id="menuModalidad">
  <label>Tu nombre: <input type="text" id="nombreJugador" placeholder="Jugador"></label><br>
  <label>Flor:
    <select id="conFlor">
      <option value="si">Con Flor</option>
      <option value="no">Sin Flor</option>
    </select>
  </label><br>
  <label>Puntaje m√°ximo:
    <select id="puntajeMax">
      <option value="15">15 puntos</option>
      <option value="30">30 puntos</option>
    </select>
  </label><br>
  <button id="btnIniciar">Iniciar partida</button>
</div>

<div class="mesa" id="mesaJuego">
<h3>Puntaje</h3>
<p><span id="nombreJugadorDisplay">Jugador</span>: <span id="pJugador">0</span> | Rival: <span id="pRival">0</span></p>
<p id="tantoJugador">Tus tantos: 0</p>
<p id="tantoRival">Tantos rival: 0</p>

<h3>Rival</h3>
<div class="cartas rival" id="manoRival">
  <div class="carta" id="cartaRival1"></div>
  <div class="carta" id="cartaRival2"></div>
  <div class="carta" id="cartaRival3"></div>
</div>

<h3>Mesa</h3>
<div class="cartas" id="mesa">
  <div class="carta" id="mesaJ"></div>
  <div class="carta" id="mesaR"></div>
</div>

<h3>Tu mano</h3>
<div class="cartas" id="manoJugador">
  <div class="carta" id="jugador1"></div>
  <div class="carta" id="jugador2"></div>
  <div class="carta" id="jugador3"></div>
</div>

<div id="temporizador">Tiempo restante: <span id="timer">15</span> s</div>
<div class="log" id="log"></div>

<div class="botones">
  <button id="btnTruco">Truco</button>
  <button id="btnRetruco">Retruco</button>
  <button id="btnValeCuatro">Vale cuatro</button>
  <button id="btnEnvido">Envido</button>
  <button id="btnFlor">Flor</button>
  <button id="btnQuiero">Quiero</button>
  <button id="btnNoQuiero">No quiero</button>
  <button id="btnMazo">Ir al mazo</button>
</div>
</div>

<script>
// ===== Baraja y valores =====
const baraja=[
{n:1,p:'Espada',v:14},{n:1,p:'Basto',v:13},{n:7,p:'Espada',v:12},{n:7,p:'Oro',v:11},
{n:3,p:'Espada',v:10},{n:3,p:'Basto',v:10},{n:3,p:'Oro',v:10},{n:3,p:'Copa',v:10},
{n:2,p:'Espada',v:9},{n:2,p:'Basto',v:9},{n:2,p:'Oro',v:9},{n:2,p:'Copa',v:9},
{n:1,p:'Oro',v:8},{n:1,p:'Copa',v:8},{n:12,p:'Espada',v:7},{n:12,p:'Basto',v:7},{n:12,p:'Oro',v:7},{n:12,p:'Copa',v:7},
{n:11,p:'Espada',v:6},{n:11,p:'Basto',v:6},{n:11,p:'Oro',v:6},{n:11,p:'Copa',v:6},
{n:10,p:'Espada',v:5},{n:10,p:'Basto',v:5},{n:10,p:'Oro',v:5},{n:10,p:'Copa',v:5},
{n:7,p:'Basto',v:4},{n:7,p:'Copa',v:4},{n:6,p:'Espada',v:3},{n:6,p:'Basto',v:3},{n:6,p:'Oro',v:3},{n:6,p:'Copa',v:3},
{n:5,p:'Espada',v:2},{n:5,p:'Basto',v:2},{n:5,p:'Oro',v:2},{n:5,p:'Copa',v:2},
{n:4,p:'Espada',v:1},{n:4,p:'Basto',v:1},{n:4,p:'Oro',v:1},{n:4,p:'Copa',v:1}
];

let manoJugador=[], manoRival=[], puntosJugador=0, puntosRival=0;
let turno='jugador', timerInterval, tiempo=15;
let puntajeMax=15;
let envidoActivo=false, florActivo=false;
let trucoPuntos=1, trucoActivo=false;

// ===== Voz =====
const synth = window.speechSynthesis;
function hablar(texto){ const msg = new SpeechSynthesisUtterance(); msg.text=texto; msg.lang='es-AR'; synth.speak(msg); }

// ===== Funciones =====
function barajar(array){ let a=array.slice(); for(let i=a.length-1;i>0;i--){ let j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }

function getImage(carta){
  const p = carta.p.toLowerCase();
  return `https://upload.wikimedia.org/wikipedia/commons/thumb/0/0a/${carta.n}_de_${p}.svg/80px-${carta.n}_de_${p}.svg.png`;
}

// ===== Calcular Envido =====
function calcularEnvido(mano){
  let suits = {};
  mano.forEach(c => { if(!suits[c.p]) suits[c.p]=[]; suits[c.p].push(c.n); });
  let max = 0;
  for(let s in suits){
    let vals = suits[s];
    if(vals.length>1){
      let sum = vals.sort((a,b)=>b-a)[0]+vals.sort((a,b)=>b-a)[1]+20;
      if(sum>max) max=sum;
    } else { if(vals[0]>max) max=vals[0]; }
  }
  return max;
}

// ===== Repartir cartas =====
function repartir(){
  let b=barajar(baraja);
  manoJugador=b.splice(0,3);
  manoRival=b.splice(0,3);
  for(let i=0;i<3;i++){
    document.getElementById('jugador'+(i+1)).innerHTML=`<img src="${getImage(manoJugador[i])}">`;
    document.getElementById('cartaRival'+(i+1)).innerHTML=`<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Card_back_40.png/80px-Card_back_40.png">`;
  }
  document.getElementById('mesaJ').innerHTML=''; document.getElementById('mesaR').innerHTML='';
  document.getElementById('tantoJugador').textContent=`Tus tantos: ${calcularEnvido(manoJugador)}`;
  document.getElementById('tantoRival').textContent=`Tantos rival: ${calcularEnvido(manoRival)}`;
  setTimeout(iaCanta, 1000);
  iniciarTurno(); log('Cartas repartidas. Es tu turno.');
}

// ===== Evaluar puntaje y final =====
function sumarPuntos(jugador, puntos){
  if(jugador==='jugador'){ puntosJugador+=puntos; document.getElementById('pJugador').textContent=puntosJugador; }
  else { puntosRival+=puntos; document.getElementById('pRival').textContent=puntosRival; }
  if(puntosJugador>=puntajeMax){ alert('¬°Ganaste!'); reiniciar(); }
  if(puntosRival>=puntajeMax){ alert('¬°Perdiste!'); reiniciar(); }
}

function reiniciar(){ puntosJugador=0; puntosRival=0; repartir(); }

// ===== Turnos y temporizador =====
function iniciarTurno(){
  tiempo=15; document.getElementById('timer').textContent=tiempo;
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    tiempo--; document.getElementById('timer').textContent=tiempo;
    if(tiempo<=0){ clearInterval(timerInterval); if(turno==='jugador'){ jugarCartaJugador(0);} }
  },1000);
}

// ===== Jugar cartas =====
function jugarCartaJugador(indice){
  if(turno!=='jugador') return;
  let carta=manoJugador.splice(indice,1)[0];
  document.getElementById('mesaJ').innerHTML=`<img src="${getImage(carta)}">`;
  hablar(`Jugaste ${carta.n} de ${carta.p}`);
  turno='rival'; setTimeout(jugarCartaRival,1000);
}

function jugarCartaRival(){
  if(turno!=='rival') return;
  let carta = manoRival.splice(Math.floor(Math.random()*manoRival.length),1)[0];
  document.getElementById('mesaR').innerHTML=`<img src="${getImage(carta)}">`;
  hablar(`Rival jug√≥ su carta`);
  turno='jugador'; setTimeout(evaluarRonda,1000);
}

function evaluarRonda(){
  // Placeholder: sumar puntos por Truco/Envido/Flor
  repartir();
}

// ===== Log =====
function log(mensaje){ document.getElementById('log').textContent=mensaje; }

// ===== Eventos =====
for(let i=0;i<3;i++){ document.getElementById('jugador'+(i+1)).addEventListener('click',()=>jugarCartaJugador(i)); }
document.getElementById('btnIniciar').addEventListener('click',()=>{
  document.getElementById('menuModalidad').style.display='none';
  document.getElementById('mesaJuego').style.display='block';
  document.getElementById('nombreJugadorDisplay').textContent=document.getElementById('nombreJugador').value||'Jugador';
  puntajeMax=parseInt(document.getElementById('puntajeMax').value);
  repartir();
});

document.getElementById('btnMazo').addEventListener('click',()=>{ repartir(); hablar('Me voy al mazo'); });
document.getElementById('btnTruco').addEventListener('click',()=>{ hablar('Truco'); log('Cantaste Truco'); trucoActivo=true; trucoPuntos=1; });
document.getElementById('btnRetruco').addEventListener('click',()=>{ hablar('Retruco'); log('Cantaste Retruco'); trucoActivo=true; trucoPuntos=2; });
document.getElementById('btnValeCuatro').addEventListener('click',()=>{ hablar('Vale cuatro'); log('Cantaste Vale cuatro'); trucoActivo=true; trucoPuntos=3; });
document.getElementById('btnEnvido').addEventListener('click',()=>{ hablar('Envido'); log('Cantaste Envido'); envidoActivo=true; });
document.getElementById('btnFlor').addEventListener('click',()=>{ hablar('Flor'); log('Cantaste Flor'); florActivo=true; });
document.getElementById('btnQuiero').addEventListener('click',()=>{ hablar('Quiero'); log('Dijiste Quiero'); });
document.getElementById('btnNoQuiero').addEventListener('click',()=>{ hablar('No quiero'); log('Dijiste No Quiero'); });
</script>
</body>
</html>
